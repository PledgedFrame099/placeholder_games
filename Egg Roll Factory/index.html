<!DOCTYPE html>
<html>
    <head>
        <title>Egg Roll Factory</title>
        <link rel="icon" type="image/x-icon" href="favicon.ico">
        <style>
            #eggroll {
                background-color:white;
                border-color:white;
                border-style:solid;
                display:block;
                margin-left:auto;
                margin-right:auto;
                margin-top:50px;
                margin-bottom:50px;
            }
            #eggroll:hover {
                border-radius:90px;
                border-color:black;
                border-width:10px;
                margin-top:42px;
                margin-bottom:42px;
            }
            img {
                -webkit-user-drag:none;
                user-select:none;
                -moz-user-select:none;
                -webkit-user-select:none;
                -ms-user-select:none;
            }
            #redbutton {
                border-color:red;
                color:red;
            }
        </style>
    </head>
    <body>
        <h1 style="text-align:center; font-size:75px; margin-bottom:0px;">Egg Roll Factory Beta 0.2.10</h1>
        <button onclick="clicked()" id="eggroll">
            <img src="eggroll.png" id="image" style="width:500px; height:500px;">
        </button>
        <div style="background-color:gray; padding:10px; margin:0px 25%;"></div>
        <div id="exp" style="background-color:green; padding:10px 0px; margin-top:-20px; margin-left:25%; width:0px;"></div>
        <h1 style="text-align:center;">Level <span id="level">1</span> (<span id="exp_counter">0</span>/<span id="to_next_level">100</span>)</h1>
        <h1>Egg Rolls: <span id="counter">0</span></h1>
        <h1>Egg Rolls Per Click: <span id="cpc">1</span></h1>
        <h1>Egg Rolls Per Second: <span id="cps">0</span></h1>
        <h2>Repeatable Upgrades:</h2>
        <button onclick="upgrade(50, 1, 'cpc')">Upgrade Egg Rolls Per Click (50)</button><br>
        <br>
        <button onclick="upgrade(100, 1, 'cps')">Upgrade Egg Rolls Per Second (100)</button><br>
        <br>
        <button onclick="upgrade(500, 12, 'cpc')">Upgraded Upgrade Egg Rolls Per Click (500)</button><br>
        <br>
        <button onclick="upgrade(1000, 12, 'cps')">Gain Heavily Encouraged Volunteers (1000)</button><br>
        <br>
        <button onclick="upgrade(5000, 140, 'cpc')">Upgraded Upgraded Upgrade Egg Rolls Per Click (5000)</button><br>
        <br>
        <button onclick="upgrade(10000, 140, 'cps')">"Hire" Everyone in a Small Village (10000)</button><br>
        <br>
        <label for="buy_all">Buy All</label>
        <input type="checkbox" id="buy_all"><br>
        <br>
        <button id="redbutton" onclick="reset()">Reset Progress</button>

        <script>
            var clicks=0

            //clicks per second
            var cps=0
            //clicks per click
            var cpc=1

            //values for leveling system
            var xp=0
            var xpNeed=100
            var level=1

            //explosion progress
            var boomprog=0

            function Load(){
                //check if localstorage has data
                if(localStorage.getItem("data")!=null){
                    //set all values to saved values
                    var data=JSON.parse(localStorage.getItem("data"))
                    clicks=data[0]
                    cps=data[1]
                    cpc=data[2]
                    xp=data[3]
                    xpNeed=data[4]
                    level=data[5]
                }else{
                    //set all values to default
                    clicks=0
                    cps=0
                    cpc=1
                    xp=0
                    xpNeed=100
                    level=1
                }
                //ensure ui is up to date
                refreshUi()
            }
            function Save(){
                //save all values to localstorage
                localStorage.setItem("data",JSON.stringify([clicks,cps,cpc,xp,xpNeed,level]))
            }
            function refreshUi(){
                //update the ui
                document.getElementById('counter').innerHTML = Math.floor(clicks);
                document.getElementById('level').innerHTML=level;
                document.getElementById('to_next_level').innerHTML=Math.floor(xpNeed);
                document.getElementById('cps').innerHTML = cps;
                document.getElementById('cpc').innerHTML = cpc;
                document.getElementById('exp_counter').innerHTML = Math.floor(xp);
            }

            function reset(){
                //ask the user twice before deleting all data and resetting values to default
                if(confirm("Are you sure you want to reset all of your progress?")&&confirm('Are you really really sure? (You will not recieve anything.)')){
                    localStorage.removeItem("data")
                    clicks=0
                    cps=0
                    cpc=1
                    xp=0
                    xpNeed=100
                    level=1
                    refreshUi()
                }
            }

            function clicked(){
                //function run when the user clicks

                //add clicks and exp
                clicks+=cpc
                xp+=cpc
                if(xp>xpNeed){
                    //level up when necesary
                    levelUp()
                }

                boomprog = boomprog + 1;
                if (boomprog == 100) {
                    boom();
                }
            }
            function levelUp(){
                if(xp>xpNeed){
                    //increase level and increase xp required for next level
                    level+=1
                    document.getElementById('level').innerHTML=level
                    xp-=xpNeed
                    if(level==2){
                        xpNeed=1000
                    }else{
                        xpNeed*=1000
                    }
                    document.getElementById('to_next_level').innerHTML=xpNeed
                }
            }

            function upgrade(resourceCost, increment, type) {
                //available is 1 unless "buy all" is checked
                var available=1
                if (document.getElementById("buy_all").checked) {
                    available = Math.floor(clicks/resourceCost);
                }

                //double check that the upgrade can be purchased
                if(clicks>=resourceCost*available){
                    //decrease clicks
                    clicks -= resourceCost*available;

                    //get upgrade based on type and update html
                    if (type == 'cpc') {
                        cpc += available*increment;
                        document.getElementById('cpc').innerHTML = cpc;
                    }else if (type == 'cps') {
                        cps += available*increment;
                        document.getElementById('cps').innerHTML = cps;
                    }
                }
            }
            function boom() {
                //explosion animation
                boomprog = 0;
                document.getElementById('image').src="explosion.gif";
                setTimeout(function(){
                    document.getElementById('image').src="eggroll.png";
                }, 800);
            }

            function Run(){
                //increase clicks and xp by cps
                clicks+=cps*0.01
                xp+=cps*0.01
                if(xp>xpNeed){
                    //level up if necessary
                    levelUp()
                }

                Save()

                document.getElementById("counter").innerHTML = Math.floor(clicks);
                document.getElementById('exp').style.width = (xp/xpNeed)*50 + "%";
                document.getElementById('exp_counter').innerHTML = Math.floor(xp);
            }

            //initialize
            Load()
            refreshUi()

            //interval for primary function
            let Inter=setInterval(Run,10)
            //ensure ui is up to date every second
            let ensure=setInterval(refreshUi,1000)

        </script>
    </body>
</html>


